<mat-dialog-content>
    <h2>{{ 'schedule-edit-title' | translate }}</h2>

    <!-- Display non-editable fields -->
    <div style="margin-bottom: 20px;">
        <div><strong>{{ 'schedule-name-label' | translate }}:</strong> {{ data.name }}</div>
        <div><strong>{{ 'schedule-tagId-label' | translate }}:</strong> {{ data.tagId }}</div>
    </div>

    <form [formGroup]="formGroup">
        <!-- Periods -->
        <div formArrayName="periods">
            <div
                *ngFor="let period of periods.controls; let i = index"
                [formGroupName]="i"
                style="margin-bottom: 10px;"
            >
                <mat-form-field style="width: 150px; margin-right: 10px;">
                    <mat-label>{{ 'schedule-dayOfWeek-label' | translate }}</mat-label>
                    <mat-select formControlName="dayOfWeek">
                        <mat-option *ngFor="let day of daysOfWeek" [value]="day.value">
                            {{ day.name }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>

                <mat-form-field style="width: 100px; margin-right: 10px;">
                    <mat-label>{{ 'schedule-startTime-label' | translate }}</mat-label>
                    <input
                        matInput
                        [value]="formatTime(period.get('startTime').value)"
                        (change)="period.get('startTime').setValue(parseTime($event.target.value))"
                        placeholder="{{ data.timeFormat === '12h' ? 'hh:mm AM/PM' : 'HH:mm' }}"
                    />
                    <mat-error *ngIf="period.get('startTime')?.hasError('required')">
                        {{ 'schedule-startTime-required' | translate }}
                    </mat-error>
                    <mat-error *ngIf="period.get('startTime')?.hasError('pattern')">
                        {{ 'schedule-time-pattern' | translate }}
                    </mat-error>
                </mat-form-field>

                <mat-form-field style="width: 100px; margin-right: 10px;">
                    <mat-label>{{ 'schedule-endTime-label' | translate }}</mat-label>
                    <input
                        matInput
                        [value]="formatTime(period.get('endTime').value)"
                        (change)="period.get('endTime').setValue(parseTime($event.target.value))"
                        placeholder="{{ data.timeFormat === '12h' ? 'hh:mm AM/PM' : 'HH:mm' }}"
                    />
                    <mat-error *ngIf="period.get('endTime')?.hasError('required')">
                        {{ 'schedule-endTime-required' | translate }}
                    </mat-error>
                    <mat-error *ngIf="period.get('endTime')?.hasError('pattern')">
                        {{ 'schedule-time-pattern' | translate }}
                    </mat-error>
                </mat-form-field>

                <button
                    mat-icon-button
                    color="warn"
                    (click)="removePeriod(i)"
                    *ngIf="periods.length > 1"
                >
                    <mat-icon>delete</mat-icon>
                </button>
            </div>
        </div>

        <button mat-button color="primary" (click)="addPeriod()">
            {{ 'schedule-add-period' | translate }}
        </button>
    </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
    <button mat-button (click)="onCancel()">
        {{ 'schedule-cancel' | translate }}
    </button>
    <button
        mat-button
        color="primary"
        (click)="onSave()"
        [disabled]="!formGroup.valid"
    >
        {{ 'schedule-save' | translate }}
    </button>
</mat-dialog-actions>